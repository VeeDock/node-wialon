<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/core/search.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/core/search.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
'use strict';

var debug  = require( 'debug' )( 'wialon:core:search' );
var extend = require( 'extend' );


/**
*   Convenience class to simplify search commands
*
*   @constructor
*   @param {object} opts - Constructor options
*/
var Search = function ( opts ) {
	this.options( opts );

	this._params = {
		spec : {
			propName : 'sys_name',
			propValueMask : '*',
			sortType : 'sys_name',
			propType : 'property'
		},
		force : 0,
		flags : 0x00,
		from  : 0,
		to    : 0
	};
};


/**
*   Set options
*
*   @param {object} opts - Options
*/
Search.prototype.options = function ( opts ) {
	this._options = opts || {};
};


/**
*   Search items by property using 'core/search_items' command
*
*   @param {string} type   - Item type (itemsType)
*   @param {string} filter - Property search filter (propValueMask)
*   @param {number} flags  - Search flags
*   @param {number=} force - Force a search (0 - if such search has been done,
*          then return cached result, 1 - to do a new search )
*   @returns {Promise}
*   @see {@link http://sdk.wialon.com/wiki/en/kit/remoteapi/apiref/core/search_items}
*/
Search.prototype.search = function ( type, filter, flags, force ) {

	var params = {
		spec : {
			itemsType : type,
			propValueMask : filter
		},
		force : force,
		flags : flags
	};


	return this._search( params );

};


/**
*   Search for units using 'avl_unit' item type
*
*   @param {string} filter     - Search filter
*   @returns {Promise}
*/
Search.prototype.units = function ( filter ) {

	var params = {
		spec : {
			itemsType : 'avl_unit',
			propValueMask : filter
		},
		flags : 0x00000001
	};

	return this._search( params );

};


/**
*   Search for zones using 'avl_resource' item type. Flags are set
*   to 0x00001001.
*
*   @param {string} filter     - Search filter
*   @returns {Promise}
*/
Search.prototype.zones = function ( filter ) {

	var params = {
		spec : {
			itemsType : 'avl_resource',
			propValueMask : filter
		},
		flags : 0x00001001
	};

	return this._search( params );

};


/**
*   Alias for {@link Search#zones}
*
*   @method
*   @see Search#zones
*/
Search.prototype.geofences = Search.prototype.zones;


/**
*   Search for retranslators using 'avl_retranslator' item type. Flags are
*   set to 0x00000301.
*
*   @param {string} filter     - Search filter
*   @returns {Promise}
*/
Search.prototype.retranslators = function ( filter ) {

	var params = {
		spec : {
			itemsType : 'avl_retranslator',
			propValueMask : filter
		},
		flags : 0x00000301
	};

	return this._search( params );

};


/**
*   Internal search helper
*
*   @private
*   @param {object} params - Search parameters
*   @returns {Promise}
*/
Search.prototype._search = function ( params ) {

	var _params = this._params;
	var session = this.wialon.session;

	params = extend( true, _params, params );
	debug( params );


	return new Promise( function ( resolve, reject ) {

		session.request( 'core/search_items', params )
			.then( function ( data ) {
				resolve(  data.items );
			} )
			.catch( reject );
	} );

};


module.exports = Search;

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-apis.html">apis</a></li><li><a href="module-wialon.html">wialon</a></li></ul><h3>Classes</h3><ul><li><a href="Search.html">Search</a></li><li><a href="Session.html">Session</a></li><li><a href="W.html">W</a></li><li><a href="Zones.html">Zones</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.3</a> on Sun Oct 11 2015 17:35:19 GMT+0100 (BST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
